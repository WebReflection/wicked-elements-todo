!function(){"use strict";var e=Object.assign;function t(e){return this.matches(e)}var n={Event:CustomEvent,WeakSet:WeakSet},i=document.contains||function(e){for(;e&&e!==this;)e=e.parentNode;return this===e},o=!0,s=[],a=[],r={},c={},d={define:function(e,t){o&&(o=!1,function(e){try{new MutationObserver(h).observe(e,{subtree:!0,childList:!0})}catch(t){e.addEventListener("DOMNodeInserted",function(e){h([{addedNodes:[e.target]}])},!1)}"complete"!==e.readyState&&e.addEventListener("DOMContentLoaded",v,{once:!0})}(document));var n=typeof e;if("string"===n){if(f(e))throw new Error("duplicated: "+e);if(s.push(e),a.push(t||{}),v(),e in r){var i=f(e);i&&(r[e](i),delete r[e])}}else{if("object"!==n||1!==e.nodeType)throw new Error("undefinable: "+e);b(e,t||{})}},get:f,whenDefined:function(e){return Promise.resolve(f(e)||new Promise(function(t){r[e]=t}))}},l=function(e){var t="connected",n="dis"+t,i=e.Event,o=e.WeakSet,s=!0,a=new o;return function(e){return s&&(s=!s,function(e){var s=null;try{new MutationObserver(l).observe(e,{subtree:!0,childList:!0})}catch(t){var r=0,c=[],d=function(e){c.push(e),clearTimeout(r),r=setTimeout(function(){l(c.splice(r=0,c.length))},0)};e.addEventListener("DOMNodeRemoved",function(e){d({addedNodes:[],removedNodes:[e.target]})},!0),e.addEventListener("DOMNodeInserted",function(e){d({addedNodes:[e.target],removedNodes:[]})},!0)}function l(e){s=new f;for(var i,o=e.length,a=0;a<o;a++)u((i=e[a]).removedNodes,n,t),u(i.addedNodes,t,n);s=null}function u(e,t,n){for(var o,s=new i(t),a=e.length,r=0;r<a;1===(o=e[r++]).nodeType&&h(o,s,t,n));}function h(e,t,n,i){a.has(e)&&!s[n].has(e)&&(s[i].delete(e),s[n].add(e),e.dispatchEvent(t));for(var o=e.children||[],r=o.length,c=0;c<r;h(o[c++],t,n,i));}function f(){this[t]=new o,this[n]=new o}}(e.ownerDocument)),a.add(e),e}}(n),u={attributechanged:function(e){var t=e.Event;return function(e,t){var i={attributes:!0,attributeOldValue:!0},a=t instanceof Array&&t.length;a&&(i.attributeFilter=t.slice(0));try{new MutationObserver(o).observe(e,i)}catch(t){i.handleEvent=a?s:n,e.addEventListener("DOMAttrModified",i,!0)}return e};function n(e){i(e.target,e.attrName,e.prevValue)}function i(e,n,i){var o=new t("attributechanged");o.attributeName=n,o.oldValue=i,o.newValue=e.getAttribute(n),e.dispatchEvent(o)}function o(e){for(var t,n=0,o=e.length;n<o;n++)i((t=e[n]).target,t.attributeName,t.oldValue)}function s(e){-1<this.attributeFilter.indexOf(e.attrName)&&n(e)}}(n),connected:l,disconnected:l};function h(e){for(var t=0,n=e.length;t<n;t++)g(e[t].addedNodes,!1)}function f(t){var n=s.indexOf(t);return n<0?null:e({},a[n])}function v(){s.length&&g(document.querySelectorAll(s),!0)}function p(e){g(e.querySelectorAll(s),!0);for(var n,i,o=0,r=s.length;o<r;o++)i=s[o],!(n=c[i]||(c[i]=new WeakSet)).has(e)&&t.call(e,s[o])&&(n.add(e),b(e,a[o]))}function g(e,t){for(var n,i=0,o=e.length;i<o;i++)n=e[i],(t||1===n.nodeType)&&p(n)}function m(e,t,n,o){var s=t["on"+n];s&&(u[n](e,t.attributeFilter).addEventListener(n,s,!1),o&&i.call(document,e)&&e.dispatchEvent(new CustomEvent(n)))}function b(e,t){m(e,t,"attributechanged",!1),m(e,t,"disconnected",!1),m(e,t,"connected",!0)}var y=Object.create,E=Object.defineProperty,w=Object.getOwnPropertyNames,O=Object.getPrototypeOf,k=Object.hasOwnProperty,N=Object.prototype,L=y(d,{define:{value:function(e,t){var n=new WeakSet,i={onconnected:r},o="function"==typeof t,s=o?t.prototype:t,a=function(e){var t=[];for(;e&&e!==N;){for(var n=w(e),i=0,o=n.length;i<o;){var s=n[i++];"on"===s.slice(0,2)&&"Options"!==s.slice(-7)&&t.push({type:s.slice(2),options:e[s+"Options"]||!1})}e=O(e)}return t}(s);function r(e){var i=e.currentTarget,c=e.type;i.removeEventListener(c,r,!1),n.has(i)||(n.add(i),function(e,t,n,i,o){var s=!1,a=0,r=t.length;for(;a<r;){var c=t[a++];i.addEventListener(c.type,e,c.options),s=s||c.type===o}e.init(n),s&&e.handleEvent(n)}(o?new t:y(s),a,e,i,c))}"ondisconnected"in s&&(i.ondisconnected=r),"onattributechanged"in s&&(i.onattributechanged=r,i.attributeFilter=(o?t.observedAttributes:s.observedAttributes)||s.attributeFilter||[]),S(s,"init",j),S(s,"handleEvent",C),d.define(e,i),k.call(t,"style")&&function(e){var t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText=e:t.textContent=e;(document.head||document.querySelector("head")).appendChild(t)}(t.style)}}});function S(e,t,n){t in e||E(e,t,{value:n})}function C(e){var t="on"+e.type;t in this&&this[t](e)}function j(e){this.el=e.currentTarget}const x=Object.create(null);var A=e=>x[e]||function(e){return addEventListener("beforeunload",{name:e,handleEvent:T},!1),x[e]=JSON.parse(localStorage.getItem(e)||"{}")}(e);function T(){const{name:e}=this;localStorage.setItem(e,JSON.stringify(x[e]))}const M=e=>{const t=A(e);return t.id||(t.id=0,t.items={}),t},P=(e,t)=>{delete e[t.dataset.id],t.remove()},{forEach:q}=[];L.define(".todoapp",{style:"\n    .todo-list.completed li:not(.completed),\n    .todo-list.active li.completed {\n      display: none;\n    }\n  ",init(e){this.el=e.currentTarget,this.list=this.el.querySelector(".todo-list");const t="todos#"+(this.el.id||"");this.el.dataset.storage=t,this.data=M(t),this.list.children.length||Object.keys(this.data.items).forEach(this.add,this);const n=location.hash.slice(2);n&&this.el.querySelector(`a[href="#/${n}"]`).click()},create(e){const t=++this.data.id;this.data.items[t]={text:e,checked:!1},this.add(t)},add(e){const t=document.createElement("li");t.dataset.id=e,this.list.appendChild(t)},removeCompleted(){q.call(this.list.querySelectorAll("li.completed"),P.bind(null,this.data.items))},toggleAll(e){const{items:t}=this.data;Object.keys(t).forEach(n=>{t[n].checked=e}),this.el.dispatchEvent(new CustomEvent("update"))},onchange(e){const{target:t}=e;switch(t.className){case"new-todo":this.create(t.value),t.value="";break;case"toggle-all":this.toggleAll(t.checked)}},onclick(e){const{target:t}=e;switch(t.className){case"clear-completed":this.removeCompleted();break;default:if("A"===t.nodeName&&!t.classList.contains("selected")){this.el.querySelector("a.selected").classList.remove("selected"),t.classList.add("selected"),this.list.classList.remove("active","completed");const e=t.hash.slice(2);e&&this.list.classList.add(e)}}}}),L.define(".todoapp .todo-list li",{get info(){return this.items[this.el.dataset.id]},get items(){return M(this.storage).items},get label(){return this.el.querySelector("label")},get toggle(){return this.el.querySelector(".toggle")},init(e){this.el=e.currentTarget,this.app=this.el.closest(".todoapp"),this.app.addEventListener("update",this),this.storage=this.app.dataset.storage,this.render(),this.update()},destroy(){this.app.removeEventListener("update",this)},render(){this.el.innerHTML='\n    <div class="view">\n      <input class="toggle" type="checkbox">\n      <label></label>\n      <button class="destroy"></button>\n    </div>'},update(){const{text:e,checked:t}=this.info;this.label.textContent=e,this.toggle.checked=t,this.el.classList.toggle("completed",t)},ondblclick(e){const{target:t}=e,{label:n}=this;t===n&&(e.preventDefault(),e.stopPropagation(),n.contentEditable=!0)},onfocusout(e){const{label:t}=this;e.target===t&&(e.stopPropagation(),t.contentEditable=!1,this.info.text=t.textContent)},onkeydown(e){if("Enter"===e.key){const{label:t}=this;e.target===t&&t.contentEditable&&(e.preventDefault(),t.blur())}},onchange(e){const{target:t}=e;switch(t.className){case"toggle":e.stopPropagation(),this.info.checked=t.checked,this.el.classList.toggle("completed",t.checked)}},onclick(e){const{target:t}=e;switch(t.className){case"destroy":e.stopPropagation(),P(this.items,this.el),this.destroy()}},onupdate(){this[this.el.isConnected?"update":"destroy"]()}})}();
